version: "3"
services:
  monerod:
    build: ../../packages/nodechain-monerod
    image: monerod
    command: --stagenet --p2p-bind-ip=0.0.0.0 --p2p-bind-port=38080 --rpc-bind-ip=0.0.0.0 --rpc-bind-port=38081 --non-interactive --confirm-external-bind --prune-blockchain
    volumes:
      - ${BLOCKCHAIN_PATH}/bitmonero:/home/monero/.bitmonero

  wallet:
    build: ../../packages/nodechain-monero-wallet
    image: monero-wallet
    command: --daemon-address=monerod:38081 --stagenet --disable-rpc-login --trusted-daemon --rpc-bind-port=38088 --rpc-bind-ip=0.0.0.0 --confirm-external-bind --non-interactive --log-level=4
    volumes:
      - ${BLOCKCHAIN_PATH}/bitmonero:/home/monero/.bitmonero
    depends_on:
      - monerod
    ports:
      - "60000:38088"

  connector:
    build: ../../Connector
    environment:
      COIN: XMR
      STAGE: ${STAGE}
      PORT: ${PORT}
    image: connector
    depends_on:
      - monerod

  nginx:
    image: nginx
    volumes:
      - ${NGINX_CONFIG_PATH}:/etc/nginx/nginx.conf
      - ${CERT_PATH}:/etc/nginx/certs
    ports:
      - ${PORT}:80
      - ${SSL_PORT}:443
    depends_on:
      - connector
